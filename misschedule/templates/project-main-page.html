{% set style_file = url_for('static', filename='css/project-main-page.css') %}
{% set jquery = true %}

{% set title = team_leader['username'] + " | " + project['title'] %}
{% extends "base.html" %}

{% block content %}
<main class="container">
    <div class="leftside-menu">
        <div class="project">
            <div class="project__heading">
                <h1>Проект {{ project['project_name'] }}</h1>
                <h2>{{ project['title'] }}</h2>
            </div>
            {% if project['description'] %}
                <p class="project__description">{{  project['description']  }}</p>            
            {% else %}
                <p class="project__description no-description">Нет описания</p>
            {% endif %}
            <span class="project__reg-date">Дата создания: {{ project['reg_date'] }}</span>
        </div>
        
        <div class="users-panel">
            <h1>Пользователи</h1>
            {% for item in users %}
            <div class="user">
                <h3 class="user__name">{{ item['first_name'] }} {{ item['last_name'] }}</h3>
                <a class="user__username" href="/users/{{  item['username']  }}">@{{ item['username'] }}</a>
                <p class="user__email">Email: <a class="email-link" href="mailto:{{  item['email']  }}">{{ item['email'] }}</a></p>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="tasks">
        <h1>Задачи</h1>
        <div class="tasks__inner">
            {% for task_data in tasks %}
                {% set task = task_data["task"] %}
                {% set items = task_data["items"] %}
                <a class="task" style="background-color: {{ task['color'] | transparentize(0.25) }}">
                    <h2 class="task__title">{{ task["title"] }}</h5>
                    {% if task["description"] %}
                        <p class="task__description">{{ task["description"] }}</p>
                    {% else %}
                        <p class="task__description no-description">Нет описания</p>
                    {% endif %}
                    <!-- Line -->

                    {% if task["tag"] %}
                        <p class="task__tag">{{ task["tag"] }}</p>
                    {% endif %}

                    <p class="task__status">Статус: {{ ["запланировано", "в процессе", "готово"][task["condition"]] }}</p>

                    {% if task["duration"] %}
                        <div class="task__deadline">
                            <span>До дедлайна: </span>
                            <span class="time-to-deadline" 
                                data-seconds="{{ task['date'] | time_to_deadline(task['duration']) }}"
                                data-duration="{{ task['duration'] }}"></span>
                        </div>
                    {% else %}
                        <p class="task__description no-description">Нет описания</p>
                    {% endif %}

                </a>
            {% endfor %}
        </div>
    </div>
    
    <div class="rightside-menu">
        <div class="chat-panel">
            {% for chat in chats['chats'] %}
                <button class="chat-button">{{  chat['title']  }}</button>
            {% endfor %}
        </div>
    </div>
</main>

{% endblock %}

{% block script %}
    <script src="{{ url_for('static', filename='js/deadline-timer.js') }}"></script>
{% endblock script %}